generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model conversation {
  id                 String               @id
  title              String?
  createdAt          DateTime             @default(now())
  conversationmember conversationmember[]
  message            message[]
}

model conversationmember {
  id             String       @id
  userId         String
  conversationId String
  role           String       @default("member")
  createdAt      DateTime     @default(now())
  conversation   conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade, map: "ConversationMember_conversationId_fkey")
  user           user         @relation(fields: [userId], references: [id], onDelete: Cascade, map: "ConversationMember_userId_fkey")

  @@unique([userId, conversationId], map: "ConversationMember_userId_conversationId_key")
  @@index([conversationId], map: "ConversationMember_conversationId_fkey")
}

model message {
  id             String       @id
  conversationId String
  senderId       String
  content        String
  createdAt      DateTime     @default(now())
  conversation   conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade, map: "Message_conversationId_fkey")
  user           user         @relation(fields: [senderId], references: [id], onDelete: Cascade, map: "Message_senderId_fkey")

  @@index([conversationId, createdAt], map: "Message_conversationId_createdAt_idx")
  @@index([senderId], map: "Message_senderId_fkey")
}

model user {
  id                 String               @id
  username           String               @unique(map: "User_username_key")
  createdAt          DateTime             @default(now())
  conversationmember conversationmember[]
  message            message[]
}
